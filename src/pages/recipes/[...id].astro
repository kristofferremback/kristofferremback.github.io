---
import { getCollection, render } from 'astro:content';
import RecipeLayout from '../../layouts/RecipeLayout.astro';
import { calculateRecipeMacros } from '../../lib/macros';

export async function getStaticPaths() {
	const recipes = await getCollection('recipes');
	return recipes
		.filter((recipe) => !recipe.data.draft)
		.map((recipe) => ({ params: { id: recipe.id }, props: { recipe } }));
}

const { recipe } = Astro.props;
const { Content } = await render(recipe);

const { perServing, resolved } = calculateRecipeMacros(
	recipe.data.ingredients,
	recipe.data.servings
);

const ingredients = resolved.map((r) => ({
	name: r.name,
	amount: r.amount,
	unit: r.unit,
}));
---

<RecipeLayout
	id={recipe.id}
	title={recipe.data.title}
	description={recipe.data.description}
	prepTime={recipe.data.prepTime}
	cookTime={recipe.data.cookTime}
	servings={recipe.data.servings}
	macros={perServing}
	ingredients={ingredients}
	tags={recipe.data.tags}
>
	<Content />
</RecipeLayout>
