---
import { ClientRouter } from 'astro:transitions';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import SEO from '../components/SEO.astro';
import '../styles/global.css';

interface Props {
	title: string;
	description?: string;
	url?: string;
	type?: 'website' | 'article';
	image?: string;
	publishedTime?: Date;
	modifiedTime?: Date;
	tags?: string[];
}

const {
	title,
	description = 'Personal site of Kristoffer Remback',
	url = Astro.url.pathname,
	type = 'website',
	image,
	publishedTime,
	modifiedTime,
	tags = [],
} = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="icon" href="/favicon.ico" />
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/rss.xml" />
		<meta name="description" content={description} />
		<meta name="generator" content={Astro.generator} />
		<SEO
			title={title}
			description={description}
			url={url}
			type={type}
			image={image}
			publishedTime={publishedTime}
			modifiedTime={modifiedTime}
			tags={tags}
		/>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet" />
		<title>{title}</title>
		<ClientRouter />
		<script is:inline>
			(function () {
				function applyTheme() {
					const stored = localStorage.getItem('theme');
					if (stored === 'dark' || (!stored && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
						document.documentElement.classList.add('dark');
					} else {
						document.documentElement.classList.remove('dark');
					}
				}
				applyTheme();
				document.addEventListener('astro:after-swap', applyTheme);
			})();
		</script>
		<script is:inline>
			(function () {
				function formatLocalDates() {
					document.querySelectorAll('time.local-date').forEach(function (el) {
						var datetime = el.getAttribute('datetime');
						if (datetime) {
							el.textContent = new Date(datetime).toLocaleDateString(undefined, {
								year: 'numeric',
								month: 'short',
								day: 'numeric'
							});
						}
					});
				}
				formatLocalDates();
				document.addEventListener('astro:after-swap', formatLocalDates);
			})();
		</script>
		<script is:inline>
			(function () {
				var copyIcon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
				var checkIcon = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>';

				function setupCopyButtons() {
					document.querySelectorAll('.code-copy-btn').forEach(function (btn) {
						if (btn.dataset.bound) return;
						btn.dataset.bound = 'true';
						btn.addEventListener('click', function () {
							var text = '';
							var pre = btn.closest('pre.astro-code');
							if (pre) {
								var code = pre.querySelector('code');
								if (code) text = code.textContent || '';
							} else {
								var wrapper = btn.closest('.raw-file-wrapper');
								if (wrapper) {
									var code = wrapper.querySelector('code');
									if (code) text = code.textContent || '';
								}
							}
							if (text) {
								navigator.clipboard.writeText(text).then(function () {
									btn.innerHTML = checkIcon;
									btn.setAttribute('data-copied', '');
									setTimeout(function () {
										btn.innerHTML = copyIcon;
										btn.removeAttribute('data-copied');
									}, 2000);
								});
							}
						});
					});
				}
				if (document.readyState === 'loading') {
					document.addEventListener('DOMContentLoaded', setupCopyButtons);
				} else {
					setupCopyButtons();
				}
				document.addEventListener('astro:after-swap', setupCopyButtons);
			})();
		</script>
	</head>
	<body class="grain min-h-screen bg-stone-50 text-stone-900 dark:bg-stone-950 dark:text-stone-100 font-sans flex flex-col">
		<div class="scroll-progress"></div>
		<Header />
		<main class="flex-1 w-full max-w-3xl mx-auto px-4 py-8">
			<slot />
		</main>
		<Footer />

	</body>
</html>
